generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id       Int    @id @default(autoincrement())
  username String @unique
  password String
  folders Folder[]
  files File[]

  @@map("users")
}

model session {
  sid    String   @id @db.VarChar
  sess   Json     @db.Json
  expire DateTime @db.Timestamp(6)

  @@index([expire], map: "IDX_session_expire")
}

model Folder {
  id Int @id @default(autoincrement())
  name String
  owner User @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  ownerId Int @map("owner_id")
  parentDirectory Folder? @relation("FolderToFolder", fields: [parentDirectoryId], references: [id], onDelete: Cascade)
  parentDirectoryId Int? @map("parent_directory_id")
  childrenDirectory Folder[] @relation("FolderToFolder")
  childrenFiles File[]
  @@map("folders")
}

model File {
  id Int @id @default(autoincrement())
  name String
  size String
  uploadedAt DateTime @map("uploaded_at") @default(now())
  fileURL String @map("file_url")
  ownerId Int @map("owner_id")
  owner User @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  directoryId Int? @map("directory_id")
  directory Folder? @relation(fields: [directoryId], references: [id], onDelete: Cascade)
  @@map("files")
  @@unique([name, directoryId])
}

